$(foreach ($vmhost in get-vmhost){ $vms=$vmhost|get-vm;  $vmsVcpucount=($vms|Measure-Object -Property numcpu -Sum).sum; ""|Select @{N='Host';E={$vmhost.name}},@{N='cpu count';E={$vmhost.numcpu }},@{N='Actual vCPU allocated';E={$vmsVcpucount}},@{N='Max vCPU allocation';E={$vmhost.numcpu * 4}},@{N='Available vCPU allocation';E={($vmhost.numcpu * 4)-$vmsVcpucount}} }) |Export-Csv c:\temp\vcpus-$(get-date -f 'yyyy-MM-dd--hh--mm--ss').csv